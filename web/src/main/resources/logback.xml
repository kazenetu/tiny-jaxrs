<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE logback>
<configuration>
  <insertFromJNDI env-entry-name="java:comp/env/LOG_DIR" as="LOG_DIR" />

  <if condition='"none".equals(property("LOG_DIR"))'>
    <then>
      <!-- 開発時はコンソール出力 -->
      <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
          <pattern>%date %-15X{req.remoteHost} %c{0} %message %n</pattern>
        </encoder>
      </appender>
      <root>
        <appender-ref ref="STDOUT" />
      </root>
    </then>
    <else>
      <!-- APサーバーデプロイ時はファイル出力 -->
      <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
          <file>${LOG_DIR}/app.log</file>

          <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
              <fileNamePattern>${LOG_DIR}/app.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
              <maxHistory>7</maxHistory>
          </rollingPolicy>
          <encoder>
              <pattern>%date %logger %message %-5level %n</pattern>
          </encoder>
      </appender>
      <root level="INFO">
        <appender-ref ref="FILE" />
      </root>
    </else>
  </if>
</configuration>